"undefined"==typeof WDL&&(window.WDL={}),WDL.ajaxRetry=function(e){"use strict";return e.dataType=e.dataType||"json",e.tries=0,e.timeout=e.timeout||15e3,e.retryLimit=e.retryLimit||3,e.error=function(e,t){(e.status>=500||"timeout"==t)&&this.tries++<=this.retryLimit&&jQuery.ajax(this)},jQuery.ajax(e)},WDL.getUsableViewportHeight=function(){"use strict";var e=0;return jQuery("#page-header, body > .breadcrumb").each(function(){e+=jQuery(this).outerHeight(!0)}),"none"!=jQuery(".navbar-static-bottom .navbar-nav > li").css("float")&&(e+=jQuery("#page-footer").outerHeight(!0)),jQuery(window).height()-e},WDL.getOverflowScrollbarWidth=function(){"use strict";var e=document.createElement("div");e.style.position="absolute",e.style.height="50px",e.style.width="50px",e.style.top="-150px",e.style.left="-150px",e.style.overflowY="scroll",document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t},void 0===WDL.URI&&(WDL.URI={}),WDL.URI.expandTemplate=function(e,t){"use strict";var i=/{([^}]+)}/g;return e.replace(i,function(e,i){return encodeURIComponent(t[i])||""})},WDL.arrayShuffle=function(e){"use strict";for(var t=e.length-1;t>0;t--){var i=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[i],e[i]=r}return e},function(e){"use strict";function t(){r.css("min-height",i.height()-(n.height()+50))}var i=e(window),r=e("#page-main"),n=e("#page-header");i.on("resize",t),t()}(jQuery),function(e){"use strict";WDL.extendQueryString=function(t,i){var r=e.extend(e.deparam(t),i);return e.param(r).replace("=&","&")}}(jQuery),function(e){"use strict";var t=e.extend(e.deparam(document.location.search),e.deparam(document.location.hash));e.each(t,function(e){0===e.search(/^(utm|group|page|center|zoom|view)/)&&delete t[e]});var i=e.param(t,!0);i&&e(".item-detail-nav a").each(function(e,t){t.href=t.href.replace(/[?#].*$/,"")+"#"+i})}(jQuery),jQuery(function(e){"use strict";e('a[href^="http"]:not([href*="wdl.org/"])').add("a.download,a[download]").on("click",function(t){var i=e(this),r=this.href,n={transport:"beacon"};return ga("send","event","outbound","click",r,n),!!(t.metaKey||t.ctrlKey||t.shiftKey||i.attr("target"))||(t.preventDefault(),window.setTimeout(function(){document.location.href=r},100),!1)}),e("#site-search select[name=qla]").change(function(){e(this).parents("form").find("input[name=q]").attr("lang",this.value)})}),function(e){"use strict";e("#share-toolbar a.share").on("click",function(t){var i=e(t.delegateTarget),r=i.data("service"),n=i.data("action")||"share",a=document.location.href.replace(/[?#].*/,"");ga("send",{hitType:"social",socialNetwork:r,socialAction:n,socialTarget:a,transport:"beacon"})})}(jQuery),function(e){"use strict";e("#language-selector a").on("click",function(){var t=e(this).parent().attr("lang");ga("send",{hitType:"event",eventCategory:"Site Language",eventAction:"change",eventLabel:t,transport:"beacon"})})}(jQuery),function(e){"use strict";function t(){var t,i;if("PerformancePaintTiming"in window)t=performance.getEntriesByType("paint")[0].startTime,i="PerformancePaintTiming";else if("chrome"in window&&e.isFunction(window.chrome.loadTimes)){var r=window.chrome.loadTimes();if((t=r.firstPaintTime-r.startLoadTime)>3600)return void Sentry.captureMessage("chrome.loadTimes() reported impossible values");t=Math.round(1e3*t),i="chrome.loadTimes"}else if("performance"in window){var n=window.performance.timing;if(0===n.navigationStart)return;t=n.msFirstPaint-n.navigationStart,i="msFirstPaint"}"number"==typeof t&&t>0&&ga("send",{hitType:"timing",transport:"beacon",timingCategory:"RUM",timingVar:"First Paint (ms)",timingValue:t,timingLabel:i})}e(window).on("load",function(){setTimeout(t)})}(jQuery),function(e){"use strict";e("#similar-items").length>0&&WDL.ajaxRetry({url:"similar-items.json",dataType:"json",cache:!0,success:function(t){if(!(t.length<1)){for(var i=e("#similar-items"),r=0;r<t.length;r++){var n=t[r],a=e('<li class="list-group-item"></li>').appendTo(i);e("<a>").appendTo(a).attr("href",n.item).append(e('<p class="title"></p>').text(n.title)).prepend(e("<img>").attr({alt:n.title,title:n.title,src:n.thumbnail,width:64,height:53}))}e("#similar-items-panel").removeClass("hidden")}}})}(jQuery),jQuery(function(e){"use strict";e(".item-detail").length<1||e("#content-search").submit(function(t){t.preventDefault();var i=this.action;return i+=(this.action.indexOf("#")>-1?"&":"#")+e(this).serialize(),document.location.href=i,!1})}),jQuery(function(e){"use strict";function t(e,t){var i=l.scrollLeft,r=t<0&&0===i,n=t>0&&i>=l.scrollWidth-l.clientWidth;e.cancelable&&(r||n)&&e.preventDefault(),e.stopPropagation(),n?m():r&&g()}function i(t,i,r){var n=t.clone();return n.attr("data-wdl-id",i),n.find("img").attr("src",f.replace("{wdl_id}",i)),n.find(".caption").text(r),e("<a>").attr({href:p.replace("{wdl_id}",i),title:r}).append(n.children().detach()).appendTo(n),n}function r(){var e=0;switch(d.data("focus")){case"start":e=0;break;case"end":e=u.get(0).scrollWidth;break;default:e=h.offset().left-(u.width()/2-h.width()/2)}e=Math.max(0,e),u.scrollLeft(e)}function n(e){if(!e.previousItems&&!e.nextItems)return void d.css("max-height","0");d.css("max-height","256px");var t=u.children(".current"),n=t.clone().removeClass("current");n.find(".caret").remove(),n.find("img").attr("src","");var a,o,s=u.children("[data-wdl-id="+e.wdl_id+"]").get(0);if((!e.nextItems||e.nextItems.length<10)&&u.find(".next-page").hide(),e.nextItems)for(a=e.nextItems.length-1;a>=0;a--)o=e.nextItems[a],u.children("[data-wdl-id="+o.wdl_id+"]").length<1&&i(n,o.wdl_id,o.title).insertAfter(s);if((!e.previousItems||e.previousItems.length<10)&&u.find(".previous-page").hide(),e.previousItems)for(a=0;a<e.previousItems.length;a++)o=e.previousItems[a],u.children("[data-wdl-id="+o.wdl_id+"]").length<1&&i(n,o.wdl_id,o.title).insertBefore(s);r()}function a(t){var i=[];if(t.highlighted&&e.merge(i,e.map(t.highlighted,function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")})),s.q){var r=s.q.match(/("[^"]*"|\S+)/g);r=e.map(r,function(e){return e.replace(/(^"|"$)/g,"")}),e.merge(i,r)}if(i=e.map(i,function(e){return e.length<3||"-"==e[0]?void 0:e}),i.length>0){i=i.sort(function(e,t){return t.length-e.length});var n=new RegExp("("+i.join("|")+")","gi");e("#content-top,#metadata").children(":not(.skip-search-highlighting)").find(":not(:empty)").contents().filter(function(){return 3==this.nodeType}).each(function(t,i){var r=i.data,a=!1;r=r.replace(n,function(t){return a=!0,e("<div>").append(e("<span>").addClass("highlighted").text(t)).html()}),a&&e(i).replaceWith(r)})}}function o(t){e.ajax({url:t,data:c,dataType:"json",cache:!0}).success(function(e){if(e){try{n(e)}catch(e){Sentry.captureException(e)}try{a(e)}catch(e){Sentry.captureException(e)}}})}if(!(e(".item-detail").length<1)){var s,c;if(s=e.extend(e.deparam(document.location.search),e.deparam(document.location.hash)),e.each(s,function(e,t){0!==e.indexOf("utm")&&0!==e.indexOf("group")&&0!==e.indexOf("page")&&0!==e.indexOf("view")&&0!==e.indexOf("loclr")&&0!==e.indexOf("voice")&&t||delete s[e]}),c=e.param(s,!0)){s.q&&e("input[type=search]").val(s.q),e("a.item-view").each(function(e,t){t.href+=(t.href.indexOf("#")>-1?"&":"#")+c});var d=e("#item-search-navigation").removeAttr("hidden"),u=d.children(".items").first(),l=u.get(0),h=u.children(".current"),p=d.data("item-url")+"#"+c,f=d.data("thumbnail-url").replace(/{(height|width)}/g,"192"),m=e.throttle(1e3,!0,function(){d.find(".next-page:visible button").trigger("click")}),g=e.throttle(1e3,!0,function(){d.find(".previous-page:visible button").trigger("click")});d.find("img[data-src]").each(function(e,t){t.src=t.getAttribute("data-src")}),d.find(".search-results-nav a").each(function(e,t){t.href=t.href.replace(/\?.*$/,"")+"?"+c}),o(ITEM_SEARCH_API_URL),d.find(".next-page, .previous-page").find("button").on("click",function(){var t,i=e(this),r=i.parent();return 0===r.index()?(d.data("focus","start"),t=u.children(".item").first().data("wdl-id")):(d.data("focus","end"),t=u.children(".item").last().data("wdl-id")),o(ITEM_SEARCH_API_URL.replace(e(document.body).data("wdl-id"),t)),!1}),l.addEventListener&&(l.addEventListener("wheel",function(e){return t(e,e.deltaX)}),l.addEventListener("mousewheel",function(e){var i=e.wheelDeltaX;return e.webkitDirectionInvertedFromDevice&&(i*=-1),t(e,i)}))}}}),jQuery("#item-map").on("map-ready",function(){"use strict";WDL.ajaxRetry({url:"nearest-items.json",data:{limit:25},dataType:"json",cache:!0,success:function(e){var t=WDL.Maps.newClusterGroup();L.geoJSON(e,{pointToLayer:function(e,t){return L.circleMarker(t,{radius:6,fillColor:"#2981CA",color:"#2E6C98",weight:1,opacity:1,fillOpacity:.6})},onEachFeature:function(e,t){e.properties&&e.properties.title&&WDL.Maps.createItemPopup(t,e.properties)}}).addTo(t).on("mouseover",function(e){e.layer.openPopup()}),ItemMap.layerControl&&ItemMap.layerControl.addOverlay(t,gettext("Nearby Items")),WDL.Maps.fitBounds(ItemMap,{maxZoom:3})}})}),function(e){"use strict";function t(){var e=r.parents(".media-container").first(),t=e.find("object").detach();navigator.userAgent.indexOf("MSIE")>=0&&t.attr("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"),e.empty().append(t)}if(!e(document.body).is(".item-detail.viewer-video,.item-detail.viewer-audio"))return!1;var i=document.getElementById("player"),r=e(i);r.on("loadedmetadata",function(){i.videoWidth&&(i.width=i.videoWidth,i.height=i.videoHeight)}),e("#viewer img").on("click",function(){return i.paused?i.play():i.pause(),!1}),e("audio,video,source").on("error",function(){i.networkState==HTMLMediaElement.NETWORK_NO_SOURCE&&t()}),Modernizr.video||t()}(jQuery),WDL.Search=function(){"use strict";function e(e,t){return e.toLocaleLowerCase().indexOf(t)>-1}function t(t,i){for(var r=0;r<i.length;r++)if(e(t,i[r]))return!0;return!1}function i(e){return e.toFixed(2).toString()}function r(e){return Math.round(100*e).toString()+"%"}return{matchesTerm:e,inTerms:t,formatCoord:i,formatPercentage:r}}(),WDL.ItemSearchController=function(e){"use strict";function t(t,i,r){var n=this;this.config=r,this.widget=jQuery(t),this.viewer=i,this.query="",this.results=[],this.currentResult=-1,this.inputControl=e('<input type="search">').attr("placeholder",interpolate(gettext("Search inside this item in %(language)s:"),{language:r.searchLanguageName},!0)).attr("lang",r.searchLanguageCode).val(this.query).on("keydown",function(t){t.stopPropagation(),13==t.which&&e(this).trigger("change")}).on("change",function(){n.setQuery(this.value),e(this).blur()}),this.nextButton=e('<button type="button" class="next"></button>').append(e('<span class="title">').text(gettext("Next"))).append(e('<span class="fa fa-chevron-circle-right"></span>')).on("click",e.proxy(function(){this.currentResult<this.results.length?this.currentResult+=1:this.currentResult=0;var e=this.results[this.currentResult];e&&i.trigger("goto-page",[e[0],e[1]]);var t=this.results[this.currentResult+1%this.results.length];return t&&i.trigger("prefetch-page",[t[0],t[1]]),!1},this)),this.previousButton=e('<button type="button" class="previous"></button>').append(e('<span class="fa fa-chevron-circle-left"></span>')).append(e('<span class="title">').text(gettext("Previous"))).on("click",e.proxy(function(){this.currentResult>0?this.currentResult-=1:this.currentResult=this.results.length-1;var e=this.results[this.currentResult];if(e&&i.trigger("goto-page",[e[0],e[1]]),this.currentResult>0){var t=this.results[this.currentResult-1];i.trigger("prefetch-page",[t[0],t[1]])}return!1},this)),this.widget.append(this.previousButton).append(e("<label>").append(this.inputControl)).append('<label class="result-count" hidden></label>').append(this.nextButton)}return e.extend(t.prototype,{setQuery:function(t){(t=e.trim(t))!=this.query&&(this.query=t,this.inputControl.val(this.query),this.loadSearchResultPageList(),this.processTerms())},processTerms:function(){var t=[this.query.toLocaleLowerCase()];e.merge(t,e.map(t[0].split(/\s/),function(t){return e.merge([t],e.map(t.split(/\b/),e.trim))}));var i=[];e.each(t,function(t,r){var n=e.trim(r);n.length>0&&i.indexOf(n)<0&&i.push(r)}),this.terms=i},loadSearchResultPageList:function(){if(!this.config.matchingPagesUrl||!this.query)return void(this.results=[]);WDL.ajaxRetry({url:this.config.matchingPagesUrl,dataType:"json",data:{q:this.query,qla:this.config.searchLanguageCode}}).success(e.proxy(function(e){this.results=e,this.currentResult=-1;for(var t=this.viewer.data("group"),i=this.viewer.data("index"),r=0;r<e.length;r++){var n=e[r];n[0]<=t&&n[1]<=i&&(this.currentResult=r)}this.widget.find(".result-count").removeAttr("hidden").text(e.length+" pages"),this.viewer.trigger("search-query-changed",[this.query])},this))}}),t}(jQuery),jQuery(function(e){"use strict";function t(e){return function(t,i){if(WDL.Search.matchesTerm(i,e))return t}}function i(t){t!=m&&(m=t,document.location.hash=WDL.extendQueryString(document.location.hash,{view:t}),p.data("mode",t).removeClass("list gallery map").addClass(t),"map"==m?(e("#map").show(),n()):(e("#map").hide(),b.hide()),c.trigger("resize"),c.trigger("scroll"),e("#search-filters").find("a[href]:not(.remove)").each(function(){var e=this.href,i=e.indexOf("#");i<0?e+="#view="+t:e=e.substring(0,i)+"#"+WDL.extendQueryString(e.substring(i),{view:t}),this.href=e}))}function r(){var t=e('<div id="map" class="map-container"></div>');t.data({displayLayerControl:!1,delayScrollCapture:!0}).insertBefore(p),o=WDL.Maps.createMap(t.get(0)),o.setView([15,WDL.Maps.guessLongitude()],2,{reset:!0,animate:!1}),s=WDL.Maps.newClusterGroup(),WDL.Maps.addLayer(o,s,{title:gettext("Items")}),b.insertAfter(t)}function n(){o||r(),h.find("[itemprop=geo]:not(.mapped)").each(function(t,i){var r=e(i).addClass("mapped"),n=r.find('[itemprop="latitude"]').attr("content"),a=r.find('[itemprop="longitude"]').attr("content"),o=r.parents(".body").find("a.title").first(),c=e.trim(o.text()),d=document.createElement("a");d.href=o.attr("href");var u=document.createElement("img");u.src=r.parents(".result").find("img.thumbnail").attr("src"),d.appendChild(u);var l=document.createElement("span");l.appendChild(document.createTextNode(c)),d.appendChild(l),L.marker([n,a],{title:c}).bindPopup(d).addTo(s)});var t=h.find(".result").not(":has([itemprop=geo])").length;if(t){var i=ngettext("%s item without map coordinates is not visible","%s items without map coordinates are not visible",t);b.text(interpolate(i,[t])).show()}w&&s&&s.getLayers().length<7*y&&a()}function a(){if(w&&!x){x=!0,v++;var t=e.param(e.extend({},g,{page:v}),!0);e("<div>").load("?"+t+" #search-results",function(t,i,r){if(x=!1,"success"==i){var n=e(this);n.find(".result").appendTo(p).find(".doc.file").each(S),n.find(".pager .next.disabled").length>0&&(w=!1)}else 404==r.status&&(w=!1,f.hide());f.find(".next").toggleClass("disabled",!w),c.trigger("SearchResultsLoaded")})}}if(e("body").hasClass("search-results")){var o,s,c=e(window),d=e(document),u=e("#view-controls"),l=u.find("input[name=view-mode]"),h=e("#search-results").first(),p=h.children(".results").first(),f=h.find(".pager"),m=l.filter(":checked").val()||"list",g=e.deparam(document.location.search),v=g.page||g.search_page||1,y=h.data("page-size")||21,w=h.length>0&&p.children("div").length>=y,x=!1,b=e('<div class="alert alert-info"></div>').hide();g.search_page&&delete g.search_page,l.on("change",function(){i(this.value)}),e("#view-mode-toggle").on("click",".btn",function(e){var t=e.target.querySelector("input[name=view-mode]");t&&t.value&&i(t.value)}),f.on("click",".disabled a",function(){return!1}).on("click","a",function(){return a(),!1}),u.removeClass("hidden"),c.on("scroll touchmove",function(){if(w&&!x&&"map"!=m){(c.height()+c.scrollTop())/d.height()>.5&&a()}}),e(".results").on("click","a",function(){var t=e(this).parents(".result").attr("id");if(t){var i="#"+t;m&&"list"!=l.filter(":checked").val()&&(i+="&view="+m),window.history&&window.history.replaceState?window.history.replaceState({},null,i):window.location.hash=i}}),e(function(){function e(){document.getElementById(i)?(window.location.hash="",window.location.hash="#"+i,c.off("SearchResultsLoaded",e)):a()}var t=document.location.hash.match(/^#([0-9]+)/);if(t){var i=t[1];c.on("SearchResultsLoaded",e),c.trigger("SearchResultsLoaded")}}),c.on("ready SearchResultsLoaded",function(){e(".enable-search-map-view .results [itemprop=geo]").length>0&&u.find("label[hidden]:has([name=view-mode][value=map])").removeAttr("hidden"),"map"==m&&n()});var S=function(i,r){var n=e(r),a=n.parents(".result").data("wdl-id"),o=n.data("group"),s=n.data("index"),c=n.data("image-timestamp"),d="/"+LANGUAGE_CODE+"/item/"+a+"/content/"+o+"/"+s+"/word-coordinates.json";e.get(d).success(function(i){n.find(".snippet").first().each(function(r,d){function u(e,t){return Math.max(t[1],t[3])-Math.max(e[1],e[3])}for(var l=e(d),h=l.find("em").map(function(){return e(this).text()}).get(),p=i.height,f=0,m=0;m<h.length;m++){var g=h[m].toLocaleLowerCase();if(v=e.map(i.words,t(g)),0!==v.length){var v=v.sort(u)[0];p=Math.min(p,v[3]),f=Math.max(f,v[1])}}p==i.height&&0===f&&(p=0,f=Math.round(.2*i.height));var y=Math.max(0,p/i.height-.1),w=Math.min(1,Math.min(i.height,f/i.height+.1)),x=1/(w-y),L=MEDIA_URL+a+"/service/thumbnail/"+(c?c+"/":"")+o+"/"+s+"-"+WDL.Search.formatCoord(0)+","+WDL.Search.formatCoord(y)+"-"+WDL.Search.formatCoord(1)+","+WDL.Search.formatCoord(w)+".jpg",b=e("<img>");b.on("load",function(){l.empty(),l.siblings("a").clone().empty().append(b).appendTo(l);for(var r=0;r<h.length;r++){var n,a=h[r].toLocaleLowerCase();n=e.map(i.words,t(a));for(var o=0;o<n.length;o++){var s=n[o];if(!(s[1]>f||s[3]<p)){var c=s[3]/i.height,d=s[1]/i.height,u=s[0]/i.width,m=s[2]/i.width,g=Math.max(0,c-y-.01)*x,v=Math.min(1,d-y+.01)*x,w=Math.max(0,u-.01),L=Math.min(1,m-u+.03);e('<div class="highlighted">').css({top:WDL.Search.formatPercentage(g),bottom:WDL.Search.formatPercentage(1-v),left:WDL.Search.formatPercentage(w),width:WDL.Search.formatPercentage(L)}).insertAfter(b)}}}}),b.attr("src",L),n.attr("data-image-src",L),b.css("width",l.innerWidth()+"px")})})};e(".result .doc.file").each(S);var T=window.location.hash.match(/view=(list|gallery|map)/);T&&l.val([T[1]]).filter(":checked").trigger("click").trigger("change")}}),jQuery(function(e){"use strict";if(!(navigator.userAgent.toLowerCase().indexOf("mobile")>=0)){var t=e("#site-search input[type=search]");if(!(t.length<1)){var i=t.data("typeahead-url"),r=t.data("suggest-url");i&&r&&e.ajax({url:i,dataType:"script",cache:!0}).success(function(){var e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:r+"?q=%QUERY",filter:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push({title:r[0],count:r[1]})}return t}}});e.initialize(),t.typeahead({highlight:!0,minLength:2},{displayKey:"title",source:e.ttAdapter(),templates:{suggestion:function(e){var t=document.createElement("p"),i=document.createElement("span");return i.className="badge",i.appendChild(document.createTextNode(e.count)),t.appendChild(i),t.appendChild(document.createTextNode(e.title)),t.outerHTML}}})})}}}),function(e){"use strict";function t(){var e=r.parents(".media-container").first(),t=e.find("object").detach();navigator.userAgent.indexOf("MSIE")>=0&&t.attr("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"),e.empty().append(t)}if(!e(document.body).is(".viewer-video,.viewer-audio"))return!1;var i=document.getElementById("player"),r=e(i);r.on("loadedmetadata",function(){i.videoWidth&&(i.width=i.videoWidth,i.height=i.videoHeight,i.videoWidth>i.parentNode.clientWidth&&e("#content-top").addClass("cinema-display"))}),e("#viewer img").on("click",function(){return i.paused?i.play():i.pause(),!1}),e("audio,video,source").on("error",function(){Sentry.withScope(function(e){e.setExtra("currentSrc",i.currentSrc),e.setExtra("readyState",i.readyState),e.setExtra("networkState",i.networkState),e.setExtra("currentTime",i.currentTime),e.setExtra("duration",i.duration),null!==i.error&&e.setExtra("errorCode",i.error.code),Sentry.captureMessage("HTML5 Media Error")}),i.networkState==HTMLMediaElement.NETWORK_NO_SOURCE&&t()}),Modernizr.video||t()}(jQuery);
//# sourceMappingURL=common-bundle.min.js.map